<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel = 'import' href='../bower_components/polymer/polymer.html'>
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel = "import" href = "../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel = "import" href = "../bower_components/paper-item/paper-item.html">
<link rel = "import" href = "../bower_components/paper-listbox/paper-listbox.html">
<link rel = "import" href = "../bower_components/paper-button/paper-button.html">
<link rel = "import" href = "../bower_components/paper-styles/paper-styles.html">
<link rel = "import" href="../bower_components/iron-icons/iron-icons.html">
<link rel = "import" href = "../bower_components/paper-input/paper-input.html">
<link rel = "import" href = "../bower_components/paper-checkbox/paper-checkbox.html">
<link rel = "import" href = "../bower_components/paper-alert-dialog/paper-alert-dialog.html">
<link rel = "import" href = "../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>

<dom-module id="lm-view-profile">
  <template>
   <style include="shared-styles">
      :host {
        /* display: block; */
        padding: 10px;
      }
      .separate_sec{margin-bottom: -17px;}
        .val_dropdown
        {
        display: inline;
        }
        .close-dialog {    position: absolute;
          top: -12px;
          right: -31px;}
        .dep_dropdown
        {
          overflow: hidden;box-sizing: border-box;max-width: 77.4844px;max-height: 294.078px;
        }
        .bsn_width{    width: 65%;    margin-top: -14%; margin-bottom: -17px;}
        .icon_space{margin-right: 10px;}
        #container {display: flex;}
        paper-button{ padding: 10px; border-radius: 5px; float: right;}
        paper-button.green:hover { background-color: var(--paper-green-400);}
        paper-button.green { background-color: var(--paper-green-500); color: white;}
        paper-button.green[active] {background-color: var(--paper-red-500);}
        .style-scope.lm-view-profile {height: auto;}
        .input_width_email{width:105%;margin-top:-20%;margin-bottom:-7%;}
        .next_button {overflow: auto;}
        .row {display: flex;}
        .col {flex: 1;padding: 1em;}
        .contact_div {margin-top: -4%;}
        .confirm_info{font-size: 14px;        }
        .input_width{width:65%;margin-bottom: -10%;margin-top:1%;}
        .input_width_incm{width:65%;margin-bottom: -5%;margin-top:-2%;}
        .input_width_add{width:65%;margin-bottom: 10%;margin-top:1%;}
        .input_width_loc{width:65%;margin-bottom: 10%;margin-top:-22%;}
        .input_width_post{width:65%;margin-bottom: 10%;margin-top:-22%;}
        .User_details{margin:35px auto;width:51%;}
        .User_details paper-dropdown-menu{margin-bottom: 0;}
        paper-dropdown-menu.salutation{width: 35%;}
        .men_btn{display: block;
    padding: 3px;}
        .Salutation_detail{height: 50px;width:65%;}
        paper-dropdown-menu.Marital_Status{width:65%;margin-top: -7px;}
        paper-dropdown-menu.dependents{width:65%;margin-top:-7px;}
        paper-dropdown-menu.mob_code{width:17%;padding-right: 3px}
		    :host paper-input[disabled] {
        --paper-input-container-input-color: #afafaf;
        --paper-input-container-disabled: {
        opacity: 0.7;

        }
        }
        :host paper-dropdown-menu[disabled] {
        --paper-input-container-input-color: #afafaf;
        --paper-input-container-disabled: {

        opacity: 0.7;

        }
        } 
        paper-spinner-lite {
            --paper-spinner-color: #FF6600;
            position: absolute;
            top: 290px;
            left: 600px;
          } 
          .mob_code {width: 22%; float: left;}
          .mobile_number {padding: 1px 0 0 0;}
          .declaration_text{margin:30px 0px 8px;font-size:14px;}
    </style>
	
    <iron-ajax
               auto
               url="{{getProfileUrl}}"
               handle-as="json"
               on-response = "handleResponse"
               >
    </iron-ajax>
    <iron-ajax
              id="knockOutAjax"
              url="{{getKnockOutUrl}}"
              on-response="knockOutResponse"
              handle-as="json"
              content-type="application/json">
  </iron-ajax>
    <!-- <span>{{ajaxResponse.responseMessage}}</span> -->
    <!-- <h1>Profile Details</h1> 
               last-response='{{ajaxResponse}}'-->
    
    <iron-ajax
      id="saveProfile"
      url="http://10.138.65.226:8080/lightningmortgage/customer/editCustomer"
      handle-as="json"
      method = "POST"
      on-response = "updateEditProfile"
      body='{{ajaxResponse}}'
      content-type = "application/json"
      >
    </iron-ajax>
    

<iron-form id="userForm">
  <form>
    <div class="card User_details">         
    <paper-spinner-lite active$="{{isActive}}" class="orange active"></paper-spinner-lite> 
    <div class="confirm_info"><iron-icon icon="icons:verified-user" class="icon_space" slot="prefix"></iron-icon>
        So that we can offer you the best mortgage options, please confirm if the below information is accurate
    </div>       
        <h3><iron-icon icon="account-box" class="icon_space" slot="prefix"></iron-icon>Personal Details</h3><hr class="separate_sec">        
        <div class="row Salutation_detail"> 
          <div class="col"> 
                <paper-dropdown-menu class="salutation" label="Salutation" value="{{ajaxResponse.salutation}}">
                    <paper-listbox  slot = "dropdown-content" class="val_dropdown">
                      <paper-item>Mr.</paper-item>
                      <paper-item>Mrs.</paper-item>
                    </paper-listbox>
                  </paper-dropdown-menu>
          </div>
        </div>
          <div class="row"> 
              <div class="col"> 
                <paper-input class="input_width" required auto-validate error-message="Fill First Name" autocapitalize allowed-pattern="[a-zA-Z]" 
                label = "First name" value="{{ajaxResponse.firstName}}">
                  <iron-icon icon = "account-circle"  prefix></iron-icon>
                </paper-input>
              </div>
              <div class="col"> 
                <paper-input class="input_width" auto-validate error-message="Fill Last name" autocapitalize allowed-pattern="[a-zA-Z]" 
                  label="Last Name" required value= "{{ajaxResponse.lastName}}">
                </paper-input>
              </div>
          </div>
          <div class="row">
            <div class="col">  
                <paper-dropdown-menu auto-validate error-message="Fill Marital Status" 
                class="Marital_Status" label="Marital Status" value="{{ajaxResponse.maritalStatus}}" 
                 required auto-validate>
                    <paper-listbox  slot = "dropdown-content" class="val_dropdown">
                      <paper-item>Single</paper-item>
                      <paper-item>Married</paper-item>
                      <paper-item>Divorced</paper-item>
                    </paper-listbox>
                  </paper-dropdown-menu>
            </div>
            <div class="col">
                <paper-dropdown-menu required auto-validate error-message="No. of Dependents" 
                class="dependents" label="No of Dependents" value="{{ajaxResponse.noOfDependents}}">
                    <paper-listbox  slot = "dropdown-content" class="dep_dropdown">
                      <paper-item>0</paper-item>
                      <paper-item>1</paper-item>
                      <paper-item>2</paper-item>
                      <paper-item>3</paper-item>
                      <paper-item>4</paper-item>
                      <paper-item>5</paper-item>
                      <paper-item>6</paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
              </div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="bsn_width" readonly label="BSN(National Identifier)" value="{{ajaxResponse.bsn}}">
              </paper-input>
            </div>
            <div class="col"></div>
          </div>

          <h3><iron-icon icon="home" class="icon_space" slot="prefix"></iron-icon>Address Details</h3><hr class="separate_sec">
          <div class="row">
            <div class="col">  
              <paper-input class="input_width_add"label="Door Number" required auto-validate error-message="Fill Door Number" 
              value="{{ajaxResponse.address.doorNumber}}">
              </paper-input>
            </div>
            <div class="col">
                <paper-input class="input_width_add"label="Street Name" required auto-validate error-message="Fill Street Name" value="{{ajaxResponse.address.addressLine1}}">
                </paper-input>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="input_width_loc"label="Locality" required auto-validate error-message="Fill Locality" 
              value="{{ajaxResponse.address.addressLine2}}">
                  <iron-icon icon = "account-circle"  prefix></iron-icon>
                </paper-input>
            </div>
            <div class="col"></div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="input_width_post"type="number" required auto-validate error-message="Fill Post code" 
              label="Post code" 
                value="{{ajaxResponse.address.postCode}}" on-blur="getCityInfo"></paper-input>
            </div>
            <div class="col">
                <paper-input class="input_width_post"disabled id="cityName" label="City" value="{{ajaxResponse.address.city}}">
            </div>
          </div>

          <h3 class="contact_div"><iron-icon icon="settings-phone" class="icon_space" slot="prefix"></iron-icon>Contact Details</h3><hr class="separate_sec">
            <div class="row Contact_details">  
              <div class="col"> 
                <paper-input class="input_width"label="Home Number" required auto-validate error-message="Fill Home Number"
                 value="{{ajaxResponse.homeNumber}}" 
                  type="number">
                  <div slot="prefix"></div>
                </paper-input>
              </div>                
                <div class="col mob_number">
                  <div class="mob_code">
                    <paper-dropdown-menu class="men_btn" label="Code" value="{{ajaxResponse.salutation}}">
                        <paper-listbox  slot = "dropdown-content" >
                          <paper-item>+31</paper-item>
                          <paper-item>+91</paper-item>
                        </paper-listbox>
                      </paper-dropdown-menu>
                  </div>
                  <div class="mobile_number">
                    <paper-input class="input_width"required auto-validate error-message="Fill Mobile Number"  maxlength="10" label="Mobile" value="{{ajaxResponse.mobileNumber}}" 
                    type="number"><div slot="prefix"></div>
                    </paper-input>
                </div>
              </div>
            </div>
            <div class="row">  
              <div class="col">
                <paper-input class="input_width_email"required label="Email Address" required auto-validate error-message="Fill Email Address" 
                  value="{{ajaxResponse.emailAddress}}">
                  <iron-icon icon="mail" class="icon_space" slot="prefix"></iron-icon>
                  <div slot="suffix"></div>
                </paper-input>
              </div>
              <div class="col"></div><div class="col"></div>
            </div>

          <h3><iron-icon icon="account-balance" class="icon_space" slot="prefix"></iron-icon>Finance Details</h3><hr class="separate_sec">
          <div class="row">
            <div class="col">
              <paper-input required class="input_width"label="Monthly Family Income(confirmed)" step="200" value="{{ajaxResponse.monthlyFamilyIncome}}" type="number">
                <div slot="prefix"class="icon_space">€</div>
              </paper-input>
            </div>
            <div class="col">
              <paper-input required class="input_width" label="Monthly Family Expense" step="200" value="{{ajaxResponse.monthlyFamilyExpense}}" type="number">
                <div slot="prefix" class="icon_space">€</div>
              </paper-input>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="input_width_incm" label="Monthly Family Income (additional)" step="200" value="{{ajaxResponse.monthlyFamilyIncomeAdditonal}}" type="number">
                <div slot="prefix" class="icon_space">€</div>
              </paper-input>
            </div>
            <div class="col"></div>                
          </div>
          <div class="declaration_text">
      <paper-checkbox name="read" on-change ="sub" required> I hereby confirm that the information provided above is true and fair to the 
                best of my knowledge and that I authorize ING to contact 
                such agencies as needed to verify the correctness of the information provided</paper-checkbox>
            </div>
          <paper-alert-dialog id="validateText" confirm-button="OK">
              Request call back and Visit nearest branch
              In order to understand reject reason and provide necessary documents. 
          </paper-alert-dialog>

          <paper-alert-dialog id="confirmText" confirm-button="OK" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
              <paper-button style="position: absolute; top: -12px;right: -31px;" dialog-dismiss><iron-icon  icon="icons:cancel"></iron-icon></paper-button>
             <p> Please ensure that the information you update matches with official records. </p> <p>You will be required to 
              submit documents to support the change before the mortgage is processed. </p>
          </paper-alert-dialog>
        <div class="next_button">

          <paper-button toggles raised class = "LM-gray" on-tap="cancel">Cancel</paper-button>
          <paper-button hidden$="{{hide}}" toggles raised class ="" on-tap="knockOutCheck">Validate</paper-button>      
          <paper-button disabled$="{{!checked}}" toggles raised class = "" on-tap="updateProfile">Save</paper-button>
           <!-- <paper-button toggles raised hidden="{{hide}}" on-click="eventClick" class = "">Edit Profile</paper-button>  -->

        </div>
    </div>
  </form>
</iron-form>
    
    <iron-ajax id="cityInfoReq" url={{postCodeApiUrl}} method="GET"
        body='{{postalCodeInfo}}' handle-as="json" on-response="handleCityInfoResponse">
    </iron-ajax>
    
  </template>

  <script>
    class ViewProfile extends Polymer.Element {
      static get is() { return 'lm-view-profile'; }
      static get properties() {
        return {
          prop1: {
            type: String,
            value: "bar"
          },
          id:{
            type:String

          },
          lastName: {
            type: String,
            value: "William"
          },
          firstName: {
            type: String,
            value: "Andrew"
          },
          salutation:{
            type:String,
            value:"Mr."
          },
          bSN:{
            type:String,
            value:"BSN"
          },
          doorNumber:{
            type:String,
            value:"22"
          },
          addressLine1:
          {
            type:String,
            value:"Netherlands---------------"
          },
          addressLine2:
          {
            type:String,
            value:"Netherlands---------------"
          },
          city:{
            type:String,
            value:"Amsterdam"
          },
          homeNumber:{
            type:String,
            value:"Amsterdam"
          },
          mobileNumber:{
            type:String,
            value:"9015291725"
          },
          emailAddress:{
            type:String,
            value:"abc@gmail.com"
          },
          maritalStatus:{
            type:String,
            value:"Single"
          },
          noOfDependents:
          {
            type:String,
            value:"1"
          },
          getProfileSave:{
            type:String,
            computed : 'saveProfile(id, emailAddress)'
          },
          getProfileUrl: {
            type: String,
            computed: 'getUrl()'
          },
          getKnockOutUrl: {
            type: String,
            computed: 'getKnockUrl()'
          },
          ajaxResponse : {
            type : Object,
            value : {}
          },
          tempResponse : {
            type : Object,
            value : {}
          },
          edit :{
            type:Boolean,
            value: false
          },
          checked:{
            type:Boolean,
            value:false
          },
          hide:{
            type:Boolean,
            value:false
          }
        }
      }
      eventClick() {
        this.edit = true;
        this.hide=true;
        this.$.lmDialog.open();
      }

      updateProfile(){
        this.$.confirmText.open();
        this.$.saveProfile.generateRequest();
      }
      saveProfile(){
        this.edit=false;
        this.hide = false;
        return this.ajaxResponse;
      }
      handleResponse(data) {
       
          this.ajaxResponse = data.detail.response ;
          this.tempResponse  = JSON.parse(JSON.stringify(data.detail.response));
          
         // this.tempResponse = data.detail.response;
        
      }
            getCityInfo(){
              //this.ajaxResponse= this.tempResponse.address.postCode;
             // this.$;
              // this.isActive = true;
              let postCode = this.ajaxResponse.address.postCode;
               if(postCode!="undefined" && postCode!="")
               this.postCodeApiUrl = "https://api.bring.com/shippingguide/api/postalCode.json?clientUrl=t&country=NL&pnr="+postCode;
              this.$.cityInfoReq.generateRequest();
            }
     
      handleCityInfoResponse(res){
              let valid = res.detail.response.valid;
              if(valid){
                this.$.cityName.value = res.detail.response.result;
                //this.propertydetails["propCity"] = res.detail.response.result;
              } else {
                this.$.cityName.value = "";
              }
              this.isActive = false;
            }
      cancel() {
        this.ajaxResponse = this.tempResponse;
        this.edit=false;
        this.hide = false;
      }
      sub()
      {
        this.checked= !this.checked;
      }
        


        
        //console.log(JSON.stringify(this.saveProfile));

          
      getUrl() {
        var userId=localStorage.getItem('userId');
        return "http://10.138.65.226:8080/lightningmortgage/customer/getCustomer/"+userId;
        
      }
      getKnockUrl() {
        var userId=localStorage.getItem('userId');

        return "http://10.138.65.226:8080/lightningmortgage/knockoutCheck/"+userId;

      }
      knockOutCheck() {
        this.$.knockOutAjax.generateRequest();
      }
      knockOutResponse(data) {
        var result= data.detail.response 
        if(result && result.responseCode ==="200") {
        window.history.pushState({}, null, '/property-details');
        window.dispatchEvent(new CustomEvent('location-changed'));
        }else{
          this.$.validateText.open();
        }
      }
      updateEditProfile() {
        this.edit=false;
        this.hide = false;
      }
      json(obj) {
        return JSON.stringify(obj, null, 2);
      }
    }

    window.customElements.define(ViewProfile.is, ViewProfile);
  </script>
</dom-module>
