<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="./lm-slider.html">
<link rel="import" href="./term-conditions.html">
<link rel="import" href="shared-styles.html">

<dom-module id="product-preference">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      header
      {
        text-align: center;
      }
      .paper-button
      {
        background-color: #f60;
        color: white
      }
      .details-container
      {
        background-color: white;
        border-radius: 5px;
        overflow: auto;
        padding: 2em;
         display: block;
      }
      paper-card.white {
          --paper-card-header-color:black;
        }
        paper-card
        {
          text-align: center;
          width:400px;
          cursor: pointer;
          margin: 20px;
        }
        .flex-container{
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
        }
        .flex-item{
          flex:1;
        }
        .flex-container-bleed{
            @apply(--layout-horizontal);
            @apply(--layout-wrap);
            justify-content: center;
       }
       .flex-item-4{
           @apply(--layout-flex-4);
       }
       .bold-item{
            font-weight: bold;
       }
      
    </style>
  
    <div class="flex-container">
      <template is="dom-repeat" items="[[products]]">
        <paper-card  heading="[[item.productName]]" on-click="_callProductDetails"  class="white flex-item">
          <label>[[item.productDesc]]</label>
        </paper-card>
      </template>
    </div>

    <div class="details-container"> 
      <header>
        <h2>[[productItem.productName]]</h2>      
      </header>

       <div class="card">
               <lm-slider title='Amount' prefix='$' minval='{{productItem.minAmount}}' selected='{{offeramount}}' maxval='{{productItem.maxAmount}}'></lm-slider>      
               <lm-slider title='Tenure' minval='{{productItem.minTenure}}' maxval='{{productItem.maxTenure}}' selected='{{offerterm}}' interval='1' suffix='Years'></lm-slider>      
               <lm-slider title='Down Payment' prefix='$' minval='{{productItem.minDownpayment}}' selected='{{offerdownpayment}}' maxval='{{productItem.maxDownpayment}}'></lm-slider>
        </div>
        <div class="card flex-container-bleed"> 
           <div class="flex-item-4 bold-item">
                <div>Equated Periodic Installment(EPI) :  {{epi}}</div>               
           </div>
            <div class="flex-item-4 bold-item">
                <div>Effective APR% : 25</div>                  
            </div>
        </div>
        <term-conditions terms="[[termsArray]]"></term-conditions>
        <paper-button class="paper-button" on-click="_submitInfo">Submit</paper-button>
    </div>
    
     <iron-ajax
          auto
          url="http://10.138.65.58:8080/lightningmortgage/product/identifyProduct"
          params='{{params}}'
          handle-as="json"
          on-response="_handleResponseForProducts"
          debounce-duration="300">
     </iron-ajax>

  </template>
  

  <script>
    class ProductPreference extends Polymer.Element {
      constructor()
      {
        super();
        this.products=[];
        
      }     

      static get is() { return 'product-preference'; }

      static get properties()
      {
        return {
          productName:{
            type:String,
            value:"Product Name"
          },
          params : { 
            type :Object,
            value : {},
            observer:"_paramChanged"
          },
          productItem:{
            type:Object,
            value:{},
            observer:"_productChanged"
          },
          offeramount:{
            type:Number,
            observer:"_amountChanged"
          },
          offerterm:{
            type:Number,
            observer:"_termChanged"
          },
          offerdownpayment:{
            type:Number,
            observer:"_paymentChanged"
          },
          epi:{
            type:String,
            value:"100"

          },
          apr:{
            type:String,
            value:"2.4"

          },
          termsArray : Array

        }
      }

      updateEPI_APR()
      {
        console.log("updating");
        this.epi = this.offeramount+this.offerterm+this.offerdownpayment;
        console.log("EPI is ", this.epi);
        this.apr = this.offeramount-this.offerterm+this.offerdownpayment;
        console.log("APR  is ",this.apr);

        

      }
      _amountChanged(newValue,oldValue)
      {
        console.log(newValue+"amount"+oldValue);
        if(oldValue!==undefined)
        {
        this.updateEPI_APR();
        }
      }
      _termChanged(newValue,oldValue)
      {
        console.log(newValue+"amount"+oldValue);
        if(oldValue!==undefined)
        {
        this.updateEPI_APR();
        }
      }
      _paymentChanged(newValue,oldValue)
      {
        console.log(newValue+"amount"+oldValue);
        if(oldValue!==undefined)
        {
        this.updateEPI_APR();
        }
        
      }
     
      _callProductDetails(event)
      {
        console.log("product will be called"+event.model.item);
        this.productItem = event.model.item;
        this.offeramount=this.productItem.maxAmount;
        this.offerterm=this.productItem.maxTenure;
        this.offerdownpayment=this.productItem.maxDownpayment;


      }
      _productChanged(newValue,oldValue)
      {
        console.log("value changed "+newValue);
      }

      _paramChanged(newValue,oldValue)
      {
        console.log(oldValue+"new"+newValue);
      }
      
      _submitInfo()
      {
       let tempParam={};
        tempParam.name = "sss";
        this.params=tempParam;
        console.log(this.tempParam);
      }
      _handleResponseForProducts(data)
      {
        console.log("in response for products");
        this.products = data.detail.response;
        if(this.products)
        {
        this.productItem=this.products[0];
        this.offeramount=this.productItem.maxAmount;
        this.offerterm=this.productItem.maxTenure;
        this.offerdownpayment=this.productItem.minDownpayment;
        this.termsArray = this.productItem.terms;
        
        }
      }

    }

    window.customElements.define(ProductPreference.is, ProductPreference);
  </script>
</dom-module>
